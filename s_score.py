import tensorflow as tf
import tensorflow_hub as hub
import tensorflow_text as text
from sklearn.metrics.pairwise import cosine_similarity

def s_score(references, predictions):
    preprocess_url = "https://tfhub.dev/tensorflow/bert_en_uncased_preprocess/3"
    encoder_url = "https://tfhub.dev/tensorflow/bert_en_uncased_L-12_H-768_A-12/4"

    bert_preprocess_model = hub.KerasLayer(preprocess_url)
    references_preprocessed = bert_preprocess_model(references)

    bert_model = hub.KerasLayer(encoder_url)
    bert_references = bert_model(references_preprocessed)

    references_cls_vector = bert_references['sequence_output'][:, 0, :]

    predictions_preprocessed = bert_preprocess_model(predictions)

    bert_predictions = bert_model(predictions_preprocessed)

    predictions_cls_vector = bert_predictions['sequence_output'][:, 0, :]

    results=list()

    for i in range(len(predictions)):
        results.extend((cosine_similarity([references_cls_vector[i]], [predictions_cls_vector[i]]))[0])

    results = {'s_score': results}

    return results


references = [
    'A worker sets up a polling station the morning of the GOP primary in Florida. Fewer voters than expected turned out.</p><p>Editor&#x27;s note: John Avlon is a CNN contributor and senior political columnist for Newsweek and The Daily Beast. He is co-editor of the book &quot;Deadline Artists: America&#x27;s Greatest Newspaper Columns.&quot;</p><p>(CNN) -- Beneath Rick Santorum&#x27;s stunning three-state sweep on Tuesday stands another stubborn sign of dissatisfaction with the status quo: Republican turnout is down.</p><p>I&#x27;m talking embarrassingly, disturbingly, hey-don&#x27;t-you-know-it&#x27;s-an-election-year bad. It is a sign of a serious enthusiasm gap among the rank and file, and a particularly bad omen for Mitt Romney and the GOP in the general election.</p><p>Here&#x27;s the tale of the tape, state by state, beginning with Tuesday night: Minnesota had just more than 47,000 people turn out for its caucuses this year -- four years ago it was nearly 63,000 -- and Romney came in first, not a distant third as he did Tuesday night. In Colorado, more than 70,000 people turned out for its caucus in 2008 -- but in 2012 it was 65,000. And Missouri -- even making a generous discount for the fact that this was an entirely symbolic contest -- had 232,000 people turn out, less than half the number who did four years ago.</p><p>Even with months of pre-primary hype and attention solely devoted to the Republican field, turnout in this election cycle essentially flat-lined. In Iowa, a little more than 121,000 people voted, compared with nearly 119,000 four years before, when action in the Democratic caucuses absorbed most of the attention.</p><p>In New Hampshire, the same dynamic applied -- 245,000 voters turned out in 2012, compared with 241,000 four years before, despite Republicans being the only game in town and independents making up 47% of the total turnout in 2012, according to CNN exit polls. Take out the independent voters and you&#x27;ve got a deep net decline.</p><p>Always proudly rebellious, South Carolina has been the great outlier in this election cycle. With Newt Gingrich making an all-out push for conservatives in a conservative state, turnout was up almost 150,000 over four years before.</p><p>But in Florida, the decline became unmistakable. Maybe it decreased because the Romney and Gingrich campaigns, plus super PACS, spent more than $18 million in the Sunshine State on TV ads, of which 93% were negative in the last week alone, according to the Campaign Media Analysis Group. After all, negative ads depress turnout. But after all the mud was thrown, 1.6 million people turned out in the nation&#x27;s fourth largest state, which might sound impressive until you compare it with the nearly 2 million who turned out in 2008.</p><p>Nevada was even worse, with 32,894 people turning out to vote in a state with more than 465,000 registered Republicans. Four years before, more than 44,300 participated in the caucus. Turnout was down more than 25% despite the GOP caucuses being the only game in town. Party officials were expecting a turnout of more than 70,000.</p><p>All this should be a wake-up call for the GOP. Despite an enormous amount of national media attention devoted to each of the states to date, the response has been a notable yawn among the Republican rank and file.</p><p>The turnout numbers are even worse when you compare them with the number of registered Republicans in each state that has voted to date.</p><p>The caucuses in particular bring out an unrepresentative sample of a state&#x27;s Republican Party. For all the grass-roots romanticism, there has got to be a better way to pick a presidential nominee.</p><p>But the news is worst for Romney, long the presumptive front-runner in a party that tends to reward the man next in line.</p><p>&quot;Reluctantly Romney&quot; could be a bumper sticker, even for his supporters. The former Massachusetts governor has found it difficult to climb above 35% in national polls, meaning that a majority of Republicans still support someone else in a notably weak field. His vote margins and totals lag behind those of four years before, when he lost the nomination to John McCain in a crowded and comparatively competent field, although Minnesota is the first state he won in &#x27;08 and lost in 2012.</p><p>You reap what you sow, and part of the reason turnout is down is directly related to the problem of polarization. The Republican Party is more ideologically polarized than at any time in recent history. Therefore, it put up more purely right-wing candidates than it did four years before, when center-right leaders such as McCain and Rudy Giuliani were also in the race. A bigger tent inspired bigger turnout.</p><p>But the other reason is simple dissatisfaction with the candidates.</p><p>Republicans seem united in their anger against the president -- like the Democrats in 2004 -- but they are uninspired by their options. Draft movements for fantasy candidates ranging from Chris Christie to Mitch Daniels to Paul Ryan and even Jeb Bush have started and failed. Some party leaders show more enthusiasm for a hypothetical 2016 crop of candidates, including Marco Rubio and Bobby Jindal, than they do for the flawed choices before them in this election. Divided and dispirited is an odd place for the Republican Party to be so soon after the enthusiasms of the 2010 tea party-driven election.</p><p>The bottom line is that voter turnout matters. And what should be most troubling for Republicans is that this enthusiasm gap among the conservative base is accompanied by a lack of candidates who might appeal to independents and centrist swing voters in the general election. It is a double barrel of bad news for the Republican Party. The numbers can be spun and rationalized by professional partisan operatives all day long, but the fact remains -- voters just aren&#x27;t turning out to cast their votes for this crop of conservative candidates in 2012.</p><p>Follow CNN Opinion on Twitter.</p><p>Join the conversation on Facebook.</p><p>The opinions expressed in this commentary are solely those of John Avlon.',
    'On television nowadays, drinking is the password for anyone desperate for social approval.</p><p>And there is no better example than the Esquire Network, which began in September and has several tough-sounding new series, including &quot;Boundless,&quot; &quot;Knife Fight&quot; and &quot;Brew Dogs,&quot; that are actually lifestyle shows genteel enough to appeal to the probable target audience of moneyed metrosexuals.</p><p>The stars of the Esquire Network are long-distance runners, chefs, beer brewers, fashion gurus and actors, but they all talk about their next drink with relish and swagger: wine, Champagne, craft beer, vodka, scotch, tequila shots, moonshine and even absinthe.</p><p>It&#x27;s not so much thirst that drives the conversation on cable as it is male insecurity. For many channels, but especially for Esquire, which is trying to avoid being dismissed as Lifetime for men, alcohol is the badge of belonging, a liquid demonstration of youthful hipness, New Age machismo, and of being a &quot;dude&quot; or a &quot;bro&quot; or, as a South African canoe champion says on &quot;Boundless,&quot; using the preferred local term, a &quot;bru&quot; (which,as it happens, rhymes with brew).</p><p>A few women are allowed in the club. Aisha Tyler, an actress who is the celebrity tour guide of a recent episode of &quot;The Getaway,&quot; chose Paris as her weekend destination because, as she put it, &quot;I want to eat beautiful food and drink myself silly.&quot; She does.</p><p>That kind of barroom boasting is not quite as common on network television anymore; many of the kinds of shows that once celebrated binge drinking, if only to seem as racy as premium cable, have backed off a bit.</p><p>A key plotline of the new season of &quot;Chicago Fire&quot; (NBC) involves the widow of a young fireman who kills her friend in a drunken-driving incident and goes to jail. &quot;Mom&quot; is a new CBS comedy about a mother-and-daughter team of former addicts who are in Alcoholics Anonymous. After Charlie Sheen left &quot;Two and a Half Men,&quot; on CBS, the creator killed off his hard-drinking character. (That may have been too cold turkey: this season, the writers introduced his daughter, who seems to have inherited some of her father&#x27;s bad habits.)</p><p>The restraint is relative, and not necessarily a sign that a Puritan revival is spreading across networks. The message that drinking and driving don&#x27;t mix has sunk in, certainly, but mostly, alcohol jokes seem old hat, and writers prefer the once taboo subjects of marijuana and masturbation.</p><p>The Esquire Network has to compete with more established cable brands like Bravo and Discovery. Esquire magazine, of course, has a well-established identity, but even it is often defined by what it&#x27;s not: Playboy without the centerfolds, The New Yorker without the writers.</p><p>Most of Esquire&#x27;s television fare offers tamer escapism than hit series like &quot;The Deadliest Catch.&quot; And it is far less gonzo than almost anything on Vice, a magazine with a YouTube offshoot that is sometimes carried by HBO and offers off-kilter documentaries about places like North Korea.</p><p>On Esquire, drinking is the bond that assures viewers that, however fit, disciplined and refined, its heroes are still very much the lads. (Also, some of the top sponsors include Jose Cuervo and Grey Goose vodka.)</p><p>The hosts of &quot;Boundless,&quot; two Canadian endurance athletes, Simon Donato and Turbo Trebilcock, go to literally marathon lengths to gin up the gin, even in remote and unboozy locations like Angkor Wat in Cambodia. There, they enter a six-day, 230-kilometer marathon, and even in that unendurably hot and humid climate, amid chanting Buddhist monks, there is drinking. A German competitor guzzles a beer at every aid station, though most of the hard-core consumption is committed by a merry group of Indian runners who like to party.</p><p>&quot;Guess we needed a couple more whiskeys before we started,&quot; one of them, Manoj, says roguishly after a so-so running time on Day 1.</p><p>&quot;Brew Dogs&quot; doesn&#x27;t need to work as hard to press the point. It&#x27;s a show that follows James Watt and Martin Dickie, two young Scottish craft brewers, as they travel across America, seeking unusual ways to create artisanal beers. (The Proclaimers&#x27; song &quot;I&#x27;m Gonna Be (500 Miles)&quot; isn&#x27;t their theme song, but it should be.)</p><p>Perhaps because there is nothing quite as tedious as a man describing the nuanced notes of hops, the Scots go to macho extremes, including brewing a Colonial-style ale with corn, molasses and elements distilled from a copy of the Declaration of Independence, while atop a float in a Fourth of July parade in Pottstown, Pa. (They also coax a young woman fresh from yoga class to sip their doughnut-flavored beer while doing the downward dog.)</p><p>Ilan Hall, a chef and the host of &quot;Knife Fight,&quot; describes his series as &quot;a bare-knuckled boxing show of a cooking competition&quot; that pits chefs against each other in an &quot;after-hours war zone.&quot; (He wears a camouflage flak jacket instead of an apron.)</p><p>And sure enough, on this cooking show, eating well is an excuse to drink heavily.</p><p>As a rowdy crowd cheers them on, rival chefs drink shots and fiercely whip up delicacies like braised goat ribs with yogurt and pomegranate. In one episode, John Herndon, who got his start as a flair bartender and still likes to set cocktails and dishes on fire, takes on Trevor Rocco. Mr. Rocco prepares by eating breakfast eggs. &quot;Got to coat your stomach for all the booze we are about to drink,&quot; he explains.</p><p>In November, Esquire plans to introduce more shows, including &quot;Best Bars in America&quot; and &quot;White Collar Brawler,&quot; in which yuppie-esque lawyers, accountants and bankers are taught to box like real men.</p><p>They may have to take a punch. They almost certainly will learn how to use a punch bowl.']

predictions = [
    'John Avlon voter turnout in the is a sign of a serious enthusiasm gap among the rank and file , a bad omen for the GOP .',
    'The Esquire Network has a of lifestyle shows genteel enough to appeal to the probable target audience of moneyed metrosexuals .']

a = s_score(references, predictions)

a = {'s_score':a}